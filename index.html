<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tu as tout acceptÃ© !</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 2em;
      background-color: #f2f2f2;
    }
    h1 {
      color: #cc0000;
    }
    .info {
      margin: 1em 0;
      padding: 1em;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: none;
    }
    #mainContent.ready .info {
      display: block;
    }
    video, canvas {
      margin-top: 1em;
      max-width: 100%;
    }
    footer {
      margin-top: 3em;
      font-size: 0.9em;
      color: #555;
    }
  </style>
</head>
<body>
  <div id="mainContent">
    <h1>Alors comme Ã§a, vous avez tout acceptÃ© ?</h1>
    <p>Voici ce qu'on sait de vous maintenant ...</p>

    <div class="info" id="location">ğŸ“ Position : ...</div>
    <div class="info" id="battery">ğŸ”‹ Batterie : ...</div>
    <div class="info" id="connection">ğŸ“¶ Connexion rÃ©seau : ...</div>
    <div class="info" id="uptime">â±ï¸ Temps depuis l'ouverture : ...</div>
    <div class="info" id="device">ğŸ“± Appareil : ...</div>
    <div class="info">
      ğŸ“· CamÃ©ra (photo prise Ã  l'autorisation) : <br />
      <canvas id="snapshot" width="320" height="240"></canvas>
    </div>

    <footer>
      Ces donnÃ©es n'ont pas Ã©tÃ© rÃ©coltÃ©es... <strong>mais elles auraient pu l'Ãªtre !</strong>
    </footer>
  </div>

  <script>
    const mainContent = document.getElementById("mainContent");
    let readyCount = 0;

    function revealContent() {
      readyCount++;
      if (readyCount >= 4) {
        mainContent.classList.add("ready");
      }
    }

    // Localisation + nom de ville
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        position => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          document.getElementById("location").textContent = `ğŸ“ Position : Latitude ${lat.toFixed(5)}, Longitude ${lon.toFixed(5)}`;

          // RequÃªte Ã  une API de gÃ©ocodage inverse gratuite
          fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
            .then(response => response.json())
            .then(data => {
              const city = data.address.city || data.address.town || data.address.village || data.address.county;
              document.getElementById("location").textContent += city ? ` (${city})` : "";
              revealContent();
            })
            .catch(() => revealContent());
        },
        () => {
          document.getElementById("location").textContent = "ğŸ“ Position : refusÃ©e ou non disponible";
          revealContent();
        }
      );
    } else {
      revealContent();
    }

    // Batterie
    if (navigator.getBattery) {
      navigator.getBattery().then(battery => {
        const percent = Math.round(battery.level * 100);
        document.getElementById("battery").textContent = `ğŸ”‹ Batterie : ${percent}% ${battery.charging ? '(en charge)' : ''}`;
        revealContent();
      }).catch(() => revealContent());
    } else {
      document.getElementById("battery").textContent = "ğŸ”‹ Batterie : non disponible";
      revealContent();
    }

    // Connexion
    try {
      const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      if (connection && connection.effectiveType) {
        document.getElementById("connection").textContent = `ğŸ“¶ Connexion rÃ©seau : ${connection.effectiveType}`;
      } else {
        document.getElementById("connection").textContent = "ğŸ“¶ Connexion rÃ©seau : non disponible";
      }
    } catch (e) {
      document.getElementById("connection").textContent = "ğŸ“¶ Connexion rÃ©seau : non disponible";
    }
    revealContent();

    // Temps depuis l'ouverture de la page
    const start = performance.now();
    setInterval(() => {
      const seconds = Math.floor((performance.now() - start) / 1000);
      const minutes = Math.floor(seconds / 60);
      const remainingSeconds = seconds % 60;
      document.getElementById("uptime").textContent = `â±ï¸ Temps depuis l'ouverture : ${minutes} min ${remainingSeconds} sec`;
    }, 1000);

    // Infos appareil
    document.getElementById("device").textContent = `ğŸ“± Appareil : ${navigator.userAgent}, Langue : ${navigator.language}, RÃ©solution : ${screen.width}x${screen.height}`;

    // CamÃ©ra - capture image unique
    const canvas = document.getElementById("snapshot");
    const context = canvas.getContext("2d");

    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          const video = document.createElement("video");
          video.srcObject = stream;
          video.play();

          video.addEventListener("loadeddata", () => {
            setTimeout(() => {
              context.drawImage(video, 0, 0, canvas.width, canvas.height);
              video.pause();
              stream.getTracks().forEach(track => track.stop());
              revealContent();
            }, 1000);
          });
        })
        .catch(() => {
          document.getElementById("snapshot").replaceWith("ğŸ“· CamÃ©ra : refusÃ©e ou non disponible");
          revealContent();
        });
    } else {
      revealContent();
    }
  </script>
</body>
</html>
